<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø­ÙŠØ§Ùƒ | ÙÙ†Ø§Ø¯Ù‚</title>

  <!-- Google Fonts: Cairo -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* Afeesh family (local) */
    @font-face {
      font-family: 'Afeesh';
      src: url('./afeesh/Afeesh-Aadi.woff2') format('woff2'),
           url('./afeesh/Afeesh-Aadi.woff') format('woff'),
           url('./afeesh/Afeesh-Aadi.ttf') format('truetype');
      font-weight: 400; font-style: normal; font-display: swap;
    }
    @font-face {
      font-family: 'Afeesh';
      src: url('./afeesh/Afeesh-Mekalbaz.woff2') format('woff2'),
           url('./afeesh/Afeesh-Mekalbaz.woff') format('woff'),
           url('./afeesh/Afeesh-Mekalbaz.ttf') format('truetype');
      font-weight: 700; font-style: normal; font-display: swap;
    }
    @font-face {
      font-family: 'Afeesh';
      src: url('./afeesh/Afeesh-NosMekalbaz.woff2') format('woff2'),
           url('./afeesh/Afeesh-NosMekalbaz.woff') format('woff'),
           url('./afeesh/Afeesh-NosMekalbaz.ttf') format('truetype');
      font-weight: 600; font-style: normal; font-display: swap;
    }
    @font-face {
      font-family: 'Afeesh';
      src: url('./afeesh/Afeesh-NosMesalwa.woff2') format('woff2'),
           url('./afeesh/Afeesh-NosMesalwa.woff') format('woff'),
           url('./afeesh/Afeesh-NosMesalwa.ttf') format('truetype');
      font-weight: 300; font-style: normal; font-display: swap;
    }

    :root {
      --bg: #f5f5f7; --card: #ffffff; --ink: #0f0f10; --muted: #6b7280; --line: #0f0f10; --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; background:var(--bg); margin:0; padding:0}
    body{font-family:'Cairo', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink)}

    header.brand{text-align:center; background:#16243d; color:#ffffff; padding:20px; position:relative}
    .logo-text {
      font-family: 'Afeesh', sans-serif;
      font-weight: 700;
      font-size: 48px;
      letter-spacing: 2px;
      color: #d4af37;
    }
    .logo-sub {
      font-family: 'Afeesh', sans-serif;
      font-weight: 600;
      color: #94a3b8;
      font-size: 20px;
      margin-top: 2px;
      letter-spacing: 3px;
    }
    .home-btn {
      position: absolute;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      color: #d4af37;
      text-decoration: none;
      font-size: 15px;
      background-color: #0f0f10;
      padding: 9px 12px;
      border-radius: 999px;
    }

    main.shell{padding:12px; max-width:420px; margin:0 auto; width:100%}

    .card{background:var(--card); border:2px solid var(--line); border-radius:var(--radius); box-shadow:0 2px 0}

    .map{height:180px; border-radius:var(--radius); overflow:hidden; margin-bottom:10px}
    .map iframe{width:100%; height:100%; border:0}

    .section-title{display:flex; align-items:center; gap:8px; margin:16px 0 10px; font-size:16px; font-weight:700; color:var(--ink)}
    .section-title .emoji{font-size:20px}

    .list{display:grid; gap:8px; margin-bottom:12px}
    .item{display:grid; grid-template-columns:36px 80px 1fr; gap:8px; padding:12px; background:var(--card); border:2px solid var(--line); border-radius:999px; cursor:pointer; transition:all 0.2s; align-items:center}
    .item:hover{background:#f5f5f7; transform:translateX(-4px)}
    .pin{text-align:center; font-size:18px}
    .thumb{width:80px; height:48px; object-fit:cover; border-radius:6px}
    .label{display:flex; flex-direction:column; gap:4px}
    .label span{font-weight:700; font-size:13px; color:var(--ink); line-height:1.2}
    .distance-badge{font-size:11px; color:#666; font-weight:400}
    .rating-badge{font-size:11px; color:#ff9800; font-weight:600}

    .filter-group{display:grid; gap:8px}
    .filter-label{font-weight:700; font-size:14px; color:var(--muted)}
    .city-select{width:100%; padding:10px 12px; border:2px solid var(--line); border-radius:var(--radius); background:var(--card); font:inherit; cursor:pointer}
    .sort-buttons{display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px}
    .sort-btn{padding:10px 8px; border:2px solid var(--line); border-radius:var(--radius); background:var(--card); cursor:pointer; font:inherit; font-weight:600; font-size:12px; transition:all 0.2s}
    .sort-btn.active{background:#0f0f10; color:#ffffff}
    .sort-btn:hover{background:#f5f5f7}

    .info-panel{display:none; margin-top:10px; padding:14px; animation:fade 0.4s}
    .info-panel.active{display:block}
    .info-desc{font-size:14px; line-height:1.6; color:var(--muted); margin-bottom:16px}
    .info-grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .info-box{background:var(--bg); padding:12px; border-radius:12px; text-align:center; display:flex; flex-direction:column; align-items:center; gap:4px}
    .ib-icon{font-size:24px; margin-bottom:4px}
    .ib-label{font-size:12px; color:var(--muted); font-weight:600}
    .ib-val{font-size:14px; font-weight:700; color:var(--ink)}
    @keyframes fade{from{opacity:0; transform:translateY(-10px)}to{opacity:1; transform:translateY(0)}}

    .bottom-search{padding:12px 0 18px; position:relative}
    .search{display:grid; grid-template-columns:28px 1fr; align-items:center; gap:8px; border:2px solid var(--line); border-radius:999px; padding:10px 12px; background:var(--card)}
    .glass{text-align:center}
    .search input{appearance:none; border:0; outline:0; background:transparent; width:100%; font:inherit; color:var(--ink)}
    .search input::placeholder{color:var(--muted)}

    .autocomplete-list{display:none; position:absolute; top:100%; left:0; right:0; background:var(--card); border:2px solid var(--line); border-top:0; border-radius:0 0 var(--radius) var(--radius); max-height:200px; overflow-y:auto; z-index:100}
    .autocomplete-list.active{display:block}
    .autocomplete-item{padding:12px; border-bottom:1px solid var(--line); cursor:pointer; transition:background 0.2s}
    .autocomplete-item:hover{background:#f5f5f7}
    .autocomplete-item:last-child{border-bottom:none}
    .autocomplete-item-name{font-weight:700; color:var(--ink)}
    .autocomplete-item-desc{font-size:12px; color:var(--muted); margin-top:2px}

     footer {
      background: #16243d;
      color: #ffffff;
      text-align: center;
      font-size: 14px;
      padding: 20px;
    }

    @media (min-width:768px){.shell{padding:24px} .map{height:220px}}

    .error-toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background: #ef4444;
      color: #ffffff;
      padding: 12px 24px;
      border-radius: 999px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
      z-index: 100;
    }
    .error-toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body>
  <header class="brand">
    <a href="index.html" class="home-btn" aria-label="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">Ø§Ù„Ø±Ø¬ÙˆØ¹   </a>
    <div class="logo-text">Ø­Ù€Ù€Ù€Ù€Ù€Ù€ÙŠÙ€Ù€Ù€Ù€Ø§Ùƒ</div>
    <div class="logo-sub">HAYYAK</div>
  </header>
  <div id="error-toast" class="error-toast"></div>
  <main class="shell">
    <div class="map card" aria-label="Ø®Ø±ÙŠØ·Ø©">
      <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=51.50,22.50,56.50,26.20&amp;layer=mapnik" title="Map"></iframe>
    </div>

    <div id="info-panel" class="card info-panel">
      <h3 id="p-title" style="margin:0 0 8px"></h3>
      <div id="p-desc" class="info-desc"></div>
      <div class="info-grid">
        <div class="info-box">
          <div class="ib-icon">â­</div>
          <div class="ib-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
          <div class="ib-val" id="p-rating"></div>
        </div>
        <div class="info-box">
          <div class="ib-icon">ğŸ“</div>
          <div class="ib-label">Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
          <div class="ib-val" id="p-distance"></div>
        </div>
        <div class="info-box">
          <div class="ib-icon">ğŸ•’</div>
          <div class="ib-label">Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</div>
          <div class="ib-val" id="p-time"></div>
        </div>
        <div class="info-box">
          <div class="ib-icon">ğŸ’°</div>
          <div class="ib-label">Ø§Ù„Ø³Ø¹Ø±</div>
          <div class="ib-val" id="p-price"></div>
        </div>
      </div>
    </div>

    <div class="section-title"><span class="emoji" aria-hidden="true">ğŸ¨</span><span>ÙÙ†Ø§Ø¯Ù‚</span></div>

    <div class="controls card">
      <div class="filter-group">
        <label class="filter-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
        <select id="city-select" class="city-select" onchange="changeCity(this.value)">
          <option value="dubai">ğŸ™ï¸ Ø¯Ø¨ÙŠ</option>
          <option value="abudhabi">ğŸ›ï¸ Ø£Ø¨ÙˆØ¸Ø¨ÙŠ</option>
          <option value="sharjah">ğŸ˜ï¸ Ø§Ù„Ø´Ø§Ø±Ù‚Ø©</option>
          <option value="ajman">ğŸŒŠ Ø¹Ø¬Ù…Ø§Ù†</option>
          <option value="rak">â›°ï¸ Ø±Ø£Ø³ Ø§Ù„Ø®ÙŠÙ…Ø©</option>
          <option value="fujairah">ğŸ–ï¸ Ø§Ù„ÙØ¬ÙŠØ±Ø©</option>
          <option value="uaq">ğŸ¦… Ø£Ù… Ø§Ù„Ù‚ÙŠÙˆÙŠÙ†</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Ø±ØªÙ‘Ø¨ Ø­Ø³Ø¨:</label>
        <div class="sort-buttons">
          <button class="sort-btn active" onclick="sortPlaces('nearest')">ğŸ“ Ø§Ù„Ø£Ù‚Ø±Ø¨</button>
          <button class="sort-btn" onclick="sortPlaces('rating')">â­ Ø§Ù„Ø£Ø¹Ù„Ù‰</button>
          <button class="sort-btn" onclick="sortPlaces('price')">ğŸ’° Ø§Ù„Ø£Ø±Ø®Øµ</button>
        </div>
      </div>
    </div>

    <section class="list" id="places-list"></section>

    <div class="bottom-search">
      <div class="search">
        <div class="glass">ğŸ”</div>
        <input type="search" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙÙ†Ø§Ø¯Ù‚..." aria-label="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚" />
      </div>
      <div id="autocomplete-list" class="autocomplete-list"></div>
    </div>
  </main>
  <footer aria-hidden="true">Â© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù†Ø§ØµØ±-Ø­ÙŠØ§Ùƒ</footer>

  <script>
    // 7-City Hotel Database with premium hotels per city
    const allPlaces = {
      dubai: [
        {city:'dubai', name:'Burj Al Arab Jumeirah', lat:25.1412, lon:55.1853, rating:4.8, price:'1500', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± 7 Ù†Ø¬ÙˆÙ… Ù…Ù…ÙŠØ² Ø¹Ù„Ù‰ Ø´ÙƒÙ„å¸†'},
        {city:'dubai', name:'Emirates Palace Dubai', lat:25.1972, lon:55.2744, rating:4.7, price:'1200', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨ØªØµÙ…ÙŠÙ… Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠ'},
        {city:'dubai', name:'Atlantis The Palm', lat:25.1304, lon:55.1171, rating:4.6, price:'900', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'Ù…Ù†ØªØ¬Ø¹ ÙØ§Ø®Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø®Ù„Ø© Ø¨Ø­Ø¯ÙŠÙ‚Ø© Ù…Ø§Ø¦ÙŠØ©'},
        {city:'dubai', name:'Jumeirah Beach Hotel', lat:25.1408, lon:55.1883, rating:4.7, price:'850', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ø´Ø§Ø·Ø¦ Ø®Ø§Øµ'},
        {city:'dubai', name:'Madinat Jumeirah', lat:25.1332, lon:55.1833, rating:4.5, price:'750', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'Ù…Ù†ØªØ¬Ø¹ Ù…Ø³ØªÙˆØ­Ù‰ Ù…Ù† Ø§Ù„Ø¹Ù…Ø§Ø±Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'},
        {city:'dubai', name:'Sofitel Dubai The Palm', lat:25.1260, lon:55.1178, rating:4.6, price:'650', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¹Ù„Ù‰ Ù†Ø®Ù„Ø© Ø¬Ù…ÙŠØ±Ø§'},
        {city:'dubai', name:'Park Hyatt Dubai', lat:25.1919, lon:55.3219, rating:4.6, price:'700', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ¬ Ø¨Ø­Ø¯Ø§Ø¦Ù‚ Ø®Ø§ØµØ©'},
        {city:'dubai', name:'Dubai Hilton Creek Hotel', lat:25.2600, lon:55.3000, rating:4.5, price:'550', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ø®ÙˆØ± Ø¯Ø¨ÙŠ'},
        {city:'dubai', name:'Taj Mahal Dubai', lat:25.2354, lon:55.3003, rating:4.4, price:'450', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø¨ØªØµÙ…ÙŠÙ… Ù‡Ù†Ø¯ÙŠ ÙØ§Ø®Ø±'},
        {city:'dubai', name:'Marina Hotel Dubai', lat:25.0805, lon:55.1403, rating:4.5, price:'500', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø¨Ø¥Ø·Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø¯Ø¨ÙŠ Ù…Ø§Ø±ÙŠÙ†Ø§'},
        {city:'dubai', name:'JW Marriott Emirates Towers', lat:25.2175, lon:55.2825, rating:4.6, price:'600', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… ÙÙŠ Ø¨Ø±Ø¬ Ù…Ù† Ø£Ø¨Ø±Ø§Ø¬ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª'},
        {city:'dubai', name:'Dusit Thani Dubai', lat:25.1835, lon:55.1900, rating:4.4, price:'480', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ØªØ§ÙŠÙ„Ø§Ù†Ø¯ÙŠ Ø¨ØªØµÙ…ÙŠÙ… ÙØ§Ø®Ø±'},
        {city:'dubai', name:'InterContinental Dubai Festival City', lat:25.2214, lon:55.3519, rating:4.5, price:'520', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙØ³ØªÙŠÙØ§Ù„'},
        {city:'dubai', name:'Renaissance Dubai Downtown', lat:25.1988, lon:55.2796, rating:4.4, price:'420', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø¨ÙˆØªÙŠÙƒ Ø¨Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† Ø¨Ø±Ø¬ Ø®Ù„ÙŠÙØ©'},
        {city:'dubai', name:'Novotel Dubai Centre Garhoud', lat:25.2550, lon:55.3150, rating:4.3, price:'380', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø­Ø¯ÙŠØ« 4 Ù†Ø¬ÙˆÙ… Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª'},
      ],
      abudhabi: [
        {city: 'abudhabi', name: 'Emirates Palace Abu Dhabi', lat: 24.4833, lon: 54.6050, rating: 4.9, price: '1800', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¬Ø¯Ø§Ù‹ Ø¨ØªØµÙ…ÙŠÙ… Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠ'},
        {city: 'abudhabi', name: 'St. Regis Saadiyat Island Resort', lat: 24.5030, lon: 54.6100, rating: 4.8, price: '1400', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ ÙØ§Ø®Ø± Ø¹Ù„Ù‰ Ø¬Ø²ÙŠØ±Ø© Ø§Ù„Ø³Ø¹Ø¯ÙŠØ§Øª'},
        {city: 'abudhabi', name: 'Rosewood Abu Dhabi', lat: 24.4930, lon: 54.6064, rating: 4.7, price: '1200', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ø¥Ø·Ù„Ø§Ù„Ø§Øª Ø¨Ø§Ù†ÙˆØ±Ø§Ù…ÙŠØ©'},
        {city: 'abudhabi', name: 'Sonesta Collection Abu Dhabi Al Bahr', lat: 24.4882, lon: 54.5963, rating: 4.6, price: '900', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø­Ø¯ÙŠØ« Ø¨ØªØµÙ…ÙŠÙ… Ù…Ø¹Ù…Ø§Ø±ÙŠ Ù…Ù…ÙŠØ²'},
        {city: 'abudhabi', name: 'The Ritz-Carlton Abu Dhabi', lat: 24.5100, lon: 54.6200, rating: 4.8, price: '1300', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ø´ÙˆØ§Ø·Ø¦ Ø®Ø§ØµØ©'},
        {city: 'abudhabi', name: 'Crowne Plaza Abu Dhabi', lat: 24.4720, lon: 54.3820, rating: 4.5, price: '700', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'},
        {city: 'abudhabi', name: 'Hilton Abu Dhabi', lat: 24.4500, lon: 54.4000, rating: 4.4, price: '600', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø¨ÙˆØªÙŠÙƒ Ø¨Ø¥Ø·Ù„Ø§Ù„Ø§Øª Ø¬Ù…ÙŠÙ„Ø©'},
        {city: 'abudhabi', name: 'Beach Rotana Abu Dhabi', lat: 24.4320, lon: 54.4870, rating: 4.5, price: '680', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ ÙØ§Ø®Ø±'},
        {city: 'abudhabi', name: 'Sheraton Abu Dhabi Hotel & Resort', lat: 24.4833, lon: 54.3800, rating: 4.3, price: '550', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ Ø¹Ø§Ø¦Ù„ÙŠ'},
        {city: 'abudhabi', name: 'Anantara Eastern Mangroves Abu Dhabi Villa', lat: 24.4600, lon: 54.5100, rating: 4.6, price: '850', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ ÙØ§Ø®Ø± Ø¨ÙÙ„Ù„ Ø®Ø§ØµØ©'},
        {city: 'abudhabi', name: 'Reef Resort Saadiyat Island', lat: 24.5040, lon: 54.6110, rating: 4.5, price: '750', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø¹Ù„Ù‰ Ø¬Ø²ÙŠØ±Ø© Ø§Ù„Ø³Ø¹Ø¯ÙŠØ§Øª'},
        {city: 'abudhabi', name: 'Yas Viceroy Abu Dhabi', lat: 24.4870, lon: 54.6045, rating: 4.4, price: '650', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø¬Ø²ÙŠØ±Ø© ÙŠØ§Ø³'},
        {city: 'abudhabi', name: 'Grand Hyatt Abu Dhabi', lat: 24.4650, lon: 54.3500, rating: 4.5, price: '720', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ø®Ø¯Ù…Ø© Ø¹Ø§Ù„Ù…ÙŠØ©'},
        {city: 'abudhabi', name: 'Khalidiya Palace Rayhaan by Oryx Collection', lat: 24.4750, lon: 54.3700, rating: 4.3, price: '480', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ… ÙØ§Ø®Ø±'},
        {city: 'abudhabi', name: 'Al Manara Hotel Abu Dhabi', lat: 24.4850, lon: 54.3900, rating: 4.2, price: '420', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø¨Ø³ÙŠØ· ÙˆÙØ§Ø®Ø±'},
      ],
      sharjah: [
        {city:'sharjah', name:'Sharjah Rotana Hotel', lat:25.3222, lon:55.3761, rating:4.5, price:'550', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… Ø¨Ø¥Ø·Ù„Ø§Ù„Ø§Øª Ø¨Ø­Ø±ÙŠØ©'},
        {city:'sharjah', name:'Al Diar Lewa Hotel', lat:25.3350, lon:55.3869, rating:4.4, price:'480', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‚ØµØ¨Ø§Ø¡'},
        {city:'sharjah', name:'Coral Beach Resort Sharjah', lat:25.3275, lon:55.3625, rating:4.6, price:'650', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ ÙØ§Ø®Ø±'},
        {city:'sharjah', name:'Ramada by Wyndham Downtown Sharjah', lat:25.3500, lon:55.3680, rating:4.3, price:'420', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ… ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'},
        {city:'sharjah', name:'Hilton Sharjah', lat:25.3470, lon:55.3690, rating:4.5, price:'520', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… Ø¨Ø®Ø¯Ù…Ø§Øª Ø¹Ø§Ù„ÙŠØ©'},
        {city:'sharjah', name:'Sofitel Sharjah Waterfont', lat:25.3510, lon:55.3845, rating:4.6, price:'680', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø±ÙŠØ©'},
        {city:'sharjah', name:'Emirates Swiss Hotel', lat:25.3400, lon:55.3600, rating:4.2, price:'380', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 3 Ù†Ø¬ÙˆÙ… Ø§Ù‚ØªØµØ§Ø¯ÙŠ'},
        {city:'sharjah', name:'Arabian Courtyard Hotel & Spa', lat:25.3475, lon:55.3695, rating:4.4, price:'450', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø¨ØªØµÙ…ÙŠÙ… Ø¹Ø±Ø¨ÙŠ ØªÙ‚Ù„ÙŠØ¯ÙŠ'},
        {city:'sharjah', name:'Al Khaleej Hotel', lat:25.3365, lon:55.3830, rating:4.3, price:'390', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª'},
        {city:'sharjah', name:'Holiday Inn Sharjah Downtown', lat:25.3222, lon:55.3761, rating:4.4, price:'500', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ… Ø¨Ù…ÙˆÙ‚Ø¹ Ù…Ù…ÙŠØ²'},
        {city:'sharjah', name:'Ibis Sharjah', lat:25.3340, lon:55.3850, rating:4.2, price:'350', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ 3 Ù†Ø¬ÙˆÙ… Ø¨Ø³ÙŠØ· ÙˆØ¹Ù…Ù„ÙŠ'},
        {city:'sharjah', name:'Oceanic Hotel Khorfakkan', lat:25.3600, lon:55.3910, rating:4.5, price:'580', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ ÙÙŠ Ø®ÙˆØ±ÙÙƒØ§Ù†'},
        {city:'sharjah', name:'Sharjah Grand Hotel', lat:25.3505, lon:55.3832, rating:4.3, price:'410', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙˆØ³Ø· Ø¨Ø³ÙŠØ·'},
        {city:'sharjah', name:'Mangrove by Al Manara Collection', lat:25.1250, lon:55.3789, rating:4.2, price:'360', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ Ø¨ÙŠØ¦ÙŠ Ø§Ù‚ØªØµØ§Ø¯ÙŠ'},
        {city:'sharjah', name:'The Ritz-Carlton Sharjah', lat:25.0483, lon:55.2383, rating:4.7, price:'950', time:'Ù…ÙØªÙˆØ­ 24/7', desc:'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø¹Ø§Ù„ÙŠØ©'},
      ],
      ajman: [
        {city: 'ajman', name: 'Ajman Palace Hotel', lat: 25.4167, lon: 55.4333, rating: 4.4, price: '450', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø·Ø¦'},
        {city: 'ajman', name: 'Kempinski Hotel Ajman', lat: 25.4190, lon: 55.4340, rating: 4.6, price: '750', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª'},
        {city: 'ajman', name: 'Coral Beach Resort Ajman', lat: 25.3994, lon: 55.4797, rating: 4.5, price: '600', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ Ù…Ù…ÙŠØ²'},
        {city: 'ajman', name: 'Ajman Saray Hotel', lat: 25.4100, lon: 55.4400, rating: 4.3, price: '400', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 3 Ù†Ø¬ÙˆÙ… Ø¨Ø³ÙŠØ·'},
        {city: 'ajman', name: 'Best Western Ajman', lat: 25.4120, lon: 55.4420, rating: 4.2, price: '350', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø§Ù‚ØªØµØ§Ø¯ÙŠ Ù„Ù„Ø±Ø­Ø§Ù„Ø©'},
        {city: 'ajman', name: 'Ajman Coastline Hotel', lat: 25.4140, lon: 55.4450, rating: 4.4, price: '480', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ù…Ù†ÙˆÙ‘Ø¹'},
        {city: 'ajman', name: 'Ramada by Wyndham Ajman', lat: 25.4135, lon: 55.4430, rating: 4.3, price: '420', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ… Ø¨Ø®Ø¯Ù…Ø§Øª Ø¬ÙŠØ¯Ø©'},
        {city: 'ajman', name: 'Fairmont Ajman', lat: 25.4150, lon: 55.4440, rating: 4.7, price: '900', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ù…Ø±Ø§ÙÙ‚ ÙƒØ§Ù…Ù„Ø©'},
        {city: 'ajman', name: 'Ajman Hilton Resort', lat: 25.4333, lon: 55.4667, rating: 4.5, price: '650', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ ÙØ§Ø®Ø±'},
        {city: 'ajman', name: 'Bayview Hotel Ajman', lat: 25.4170, lon: 55.4350, rating: 4.2, price: '340', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ù…ÙŠØ³ÙˆØ± Ø§Ù„ØªÙƒÙ„ÙØ©'},
      ],
      rak: [
        {city: 'rak', name: 'Hilton Ras Al Khaimah Resort & Spa', lat: 25.9533, lon: 56.1603, rating: 4.6, price: '700', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø¬Ø¨Ù„ÙŠ ÙØ§Ø®Ø± Ø¨Ù…Ù†ØªØ¬Ø¹ ØµØ­ÙŠ'},
        {city: 'rak', name: 'Banyan Tree Al Wadi', lat: 25.9467, lon: 56.1358, rating: 4.7, price: '1100', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ ÙØ§Ø®Ø± Ø¬Ø¯Ø§Ù‹ ÙÙŠ Ø§Ù„ÙˆØ§Ø¯ÙŠ'},
        {city: 'rak', name: 'Waldorf Astoria Ras Al Khaimah', lat: 25.6961, lon: 55.7864, rating: 4.8, price: '1300', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ§Ø®Ø± Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø¹Ø§Ù„Ù…ÙŠØ©'},
        {city: 'rak', name: 'Marriott Beach Resort Ras Al Khaimah', lat: 25.6167, lon: 56.0000, rating: 4.5, price: '650', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ Ø¹Ø§Ø¦Ù„ÙŠ'},
        {city: 'rak', name: 'Ras Al Khaimah Hotel', lat: 25.6500, lon: 56.0500, rating: 4.2, price: '380', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø¨Ø³ÙŠØ· ÙˆÙØ§Ø®Ø±'},
        {city: 'rak', name: 'Accentra Hotel Ras Al Khaimah', lat: 25.6700, lon: 56.0600, rating: 4.3, price: '420', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 3 Ù†Ø¬ÙˆÙ… Ø§Ù‚ØªØµØ§Ø¯ÙŠ'},
        {city: 'rak', name: 'The Cove Rotana Resort Ras Al Khaimah', lat: 25.6200, lon: 56.0100, rating: 4.6, price: '750', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ Ø¨ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ«'},
        {city: 'rak', name: 'Mina Al Arab Beach Resort', lat: 25.6300, lon: 56.0200, rating: 4.4, price: '550', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ÙŠ Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª'},
        {city: 'rak', name: 'Danat Al Ain Hotel', lat: 25.7000, lon: 56.1000, rating: 4.3, price: '390', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ø¨Ù„ÙŠØ¯'},
        {city: 'rak', name: 'Bin Majid Beach Resort', lat: 25.7200, lon: 56.1200, rating: 4.5, price: '620', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ Ø¹Ø±ÙŠÙ‚'},
      ],
      fujairah: [
        {city: 'fujairah', name: 'Le MÃ©ridien Al Aqah Beach Resort', lat: 25.1167, lon: 56.3500, rating: 4.7, price: '850', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ ÙØ§Ø®Ø± Ù…Ø¹ ØºÙˆØµ'},
        {city: 'fujairah', name: 'Sandy Beach Hotel', lat: 25.4933, lon: 56.3636, rating: 4.5, price: '650', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ù…Ù…ÙŠØ²'},
        {city: 'fujairah', name: 'Fujairah Beach Hotel', lat: 25.1167, lon: 56.3500, rating: 4.4, price: '520', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ø¨Ø³ÙŠØ·'},
        {city: 'fujairah', name: 'Dusit Thani Fujairah', lat: 25.1400, lon: 56.3350, rating: 4.6, price: '750', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ØªØ§ÙŠÙ„Ø§Ù†Ø¯ÙŠ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ ÙØ§Ø®Ø±'},
        {city: 'fujairah', name: 'Fujairah Rotana Resort & Spa', lat: 25.4500, lon: 56.3600, rating: 4.5, price: '680', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ ÙØ§Ø®Ø± Ù…Ø¹ Ù…Ù†ØªØ¬Ø¹ ØµØ­ÙŠ'},
        {city: 'fujairah', name: 'Coral Beach Resort Fujairah', lat: 25.1350, lon: 56.3360, rating: 4.5, price: '600', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ Ù…Ø¹ Ù…Ø±Ø§ÙÙ‚ ÙƒØ§Ù…Ù„Ø©'},
        {city: 'fujairah', name: 'Miramar Al Aqah Beach Resort', lat: 25.4950, lon: 56.3650, rating: 4.4, price: '550', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ø¹Ø§Ø¦Ù„ÙŠ'},
        {city: 'fujairah', name: 'Hilton Fujairah', lat: 25.1389, lon: 56.3361, rating: 4.5, price: '620', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 5 Ù†Ø¬ÙˆÙ… Ø­Ø¯ÙŠØ«'},
        {city: 'fujairah', name: 'Paradise Island Resort Fujairah', lat: 25.1405, lon: 56.3380, rating: 4.3, price: '480', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø¹Ø§Ø¦Ù„ÙŠ Ø¨Ø£Ø³Ø¹Ø§Ø± Ù…Ø¹Ù‚ÙˆÙ„Ø©'},
        {city: 'fujairah', name: 'Oceanside Hotel Fujairah', lat: 25.5200, lon: 56.3500, rating: 4.2, price: '400', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø¨Ø³ÙŠØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±'},
      ],
      uaq: [
        {city: 'uaq', name: 'Umm Al Quwain Beach Hotel', lat: 25.5947, lon: 55.6633, rating: 4.4, price: '480', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª'},
        {city: 'uaq', name: 'Al Marjan Island Resort', lat: 25.5167, lon: 55.5833, rating: 4.5, price: '620', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø¹Ù„Ù‰ Ø¬Ø²ÙŠØ±Ø© ÙØ§Ø®Ø±'},
        {city: 'uaq', name: 'Umm Al Quwain Rotana', lat: 25.5933, lon: 55.5633, rating: 4.3, price: '420', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ 4 Ù†Ø¬ÙˆÙ… Ø¨Ø³ÙŠØ·'},
        {city: 'uaq', name: 'Siniyah Island Resort', lat: 25.6167, lon: 55.6000, rating: 4.6, price: '750', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø¹Ù„Ù‰ Ø¬Ø²ÙŠØ±Ø© Ù…Ø­Ù…ÙŠØ©'},
        {city: 'uaq', name: 'Coral Beach Resort UAQ', lat: 25.5950, lon: 55.6640, rating: 4.4, price: '550', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ ØµØºÙŠØ±'},
        {city: 'uaq', name: 'Palm Beach Hotel', lat: 25.6050, lon: 55.5900, rating: 4.3, price: '450', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ø§Ù‚ØªØµØ§Ø¯ÙŠ'},
        {city: 'uaq', name: 'Floating Beach Hotel', lat: 25.6170, lon: 55.6010, rating: 4.5, price: '600', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ ÙØ±ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¡'},
        {city: 'uaq', name: 'UAQ Marina Hotel', lat: 25.5995, lon: 55.6640, rating: 4.2, price: '380', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø¨Ø³ÙŠØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ¬'},
        {city: 'uaq', name: 'Dream Beach Resort UAQ', lat: 25.6070, lon: 55.6060, rating: 4.4, price: '520', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'Ù…Ù†ØªØ¬Ø¹ Ø´Ø§Ø·Ø¦ Ø­Ø¯ÙŠØ«'},
        {city: 'uaq', name: 'Golden Beach Hotel', lat: 25.6110, lon: 55.6090, rating: 4.3, price: '420', time: 'Ù…ÙØªÙˆØ­ 24/7', desc: 'ÙÙ†Ø¯Ù‚ Ø´Ø§Ø·Ø¦ÙŠ Ø¨Ø³ÙŠØ·'},
      ],
    };

    let currentCity = 'dubai';
    let currentSort = 'nearest';
    let filteredPlaces = [];
    let userLocation = {lat: 25.2048, lon: 55.2708}; // Dubai default

    function getUserLocation() {
      const userProfile = JSON.parse(localStorage.getItem('hayyak_user_profile') || '{}');
      if (userProfile.latitude && userProfile.longitude) {
        userLocation = {lat: parseFloat(userProfile.latitude), lon: parseFloat(userProfile.longitude)};
      }

      if (userProfile.emirate) {
        const map = {
          'Abu Dhabi': 'abudhabi', 'Dubai': 'dubai', 'Sharjah': 'sharjah',
          'Ajman': 'ajman', 'Ras Al Khaimah': 'rak', 'Fujairah': 'fujairah',
          'Umm Al Quwain': 'uaq'
        };
        if (map[userProfile.emirate]) {
          currentCity = map[userProfile.emirate];
          const select = document.getElementById('city-select');
          if (select) select.value = currentCity;
        }
      }
    }

    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return (R * c).toFixed(1);
    }

    function filterAndSort() {
      let places = allPlaces[currentCity] || [];
      filteredPlaces = places.map(p => ({
        ...p,
        distance: calculateDistance(userLocation.lat, userLocation.lon, p.lat, p.lon)
      }));

      if (currentSort === 'nearest') filteredPlaces.sort((a,b) => parseFloat(a.distance) - parseFloat(b.distance));
      else if (currentSort === 'rating') filteredPlaces.sort((a,b) => b.rating - a.rating);
      else if (currentSort === 'price') filteredPlaces.sort((a,b) => {
        const pa = a.price === 'Ù…ØªÙØ§ÙˆØª' || a.price === '0' ? 999 : parseInt(a.price);
        const pb = b.price === 'Ù…ØªÙØ§ÙˆØª' || b.price === '0' ? 999 : parseInt(b.price);
        return pa - pb;
      });

      renderPlaces(filteredPlaces.slice(0, 4));
    }

    function renderPlaces(places) {
      const list = document.getElementById('places-list');
      list.innerHTML = '';
      places.forEach(p => {
        const item = document.createElement('article');
        item.className = 'item';
        item.onclick = () => showPlace(p.name, p.lat, p.lon, p.rating, p.price, p.time, p.desc, p.distance);
        item.innerHTML = `
          <div class="pin">ğŸ¨</div>
          <img class="thumb" src="https://placehold.co/80x48?text=${encodeURIComponent(p.name)}" alt="${p.name}">
          <div class="label">
            <span>${p.name}</span>
            <span class="distance-badge">${p.distance} ÙƒÙ…</span>
            <span class="rating-badge">â­ ${p.rating}</span>
          </div>
        `;
        list.appendChild(item);
      });
    }

    function sortPlaces(type) {
      currentSort = type;
      document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      filterAndSort();
    }

    function changeCity(city) {
      currentCity = city;
      filterAndSort();
    }

    function showPlace(title, lat, lon, rating, price, time, desc, distance) {
      const panel = document.getElementById('info-panel');
      
      // Toggle: if same place is clicked twice, hide the panel
      if (panel.dataset.currentPlace === title && panel.classList.contains('active')) {
        panel.classList.remove('active');
        panel.dataset.currentPlace = '';
        return;
      }
      
      panel.dataset.currentPlace = title;
      const bbox = `${lon-0.008},${lat-0.008},${lon+0.008},${lat+0.008}`;
      document.querySelector('.map iframe').src = `https://www.openstreetmap.org/export/embed.html?bbox=${bbox}&layer=mapnik`;
      document.getElementById('p-title').innerText = title;
      document.getElementById('p-rating').innerText = `${rating}/5`;
      document.getElementById('p-distance').innerText = `${distance} ÙƒÙ…`;
      document.getElementById('p-time').innerText = time;
      document.getElementById('p-price').innerText = price === '0' ? 'Ù…Ø¬Ø§Ù†ÙŠ' : price + ' Ø¯Ø±Ù‡Ù…';
      document.getElementById('p-desc').innerText = desc;
      panel.classList.add('active');

      const item = { title, lat, lon, date: new Date().toISOString() };
      let history = JSON.parse(localStorage.getItem('hayyak_history') || '[]');
      history = history.filter(i => i.title !== title);
      history.unshift(item);
      if (history.length > 20) history.pop();
      localStorage.setItem('hayyak_history', JSON.stringify(history));
    }

    let toastTimeout;
    function showError(message) {
      const toast = document.getElementById('error-toast');
      if (!toast) {
        const newToast = document.createElement('div');
        newToast.id = 'error-toast';
        newToast.className = 'error-toast';
        document.body.appendChild(newToast);
      }
      const toast2 = document.getElementById('error-toast');
      toast2.innerText = message;
      toast2.classList.add('show');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toast2.classList.remove('show');
      }, 3500);
    }

    const searchInput = document.getElementById('search-input');
    const autocompleteList = document.getElementById('autocomplete-list');
    
    searchInput.addEventListener('input', function (e) {
      const query = this.value.trim();
      if (query.length >= 2) {
        showAutocomplete(query);
      } else {
        autocompleteList.classList.remove('active');
      }
    });

    searchInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        const query = this.value.trim();
        if (query.length >= 2) {
          performSearch(query);
          autocompleteList.classList.remove('active');
        }
      }
    });

    function showAutocomplete(query) {
      const queryLower = query.toLowerCase().trim();
      const results = Object.values(allPlaces).flat().filter(p => 
        p.name.toLowerCase().includes(queryLower) || p.desc.toLowerCase().includes(queryLower)
      ).slice(0, 5); // Show top 5 results

      if (results.length === 0) {
        autocompleteList.classList.remove('active');
        return;
      }

      autocompleteList.innerHTML = results.map(place => `
        <div class="autocomplete-item" onclick="selectPlace('${place.name}', ${place.lat}, ${place.lon}, ${place.rating}, '${place.price}', '${place.time}', '${place.desc}', '${place.city}')">
          <div class="autocomplete-item-name">${place.name}</div>
          <div class="autocomplete-item-desc">${place.desc}</div>
        </div>
      `).join('');
      
      autocompleteList.classList.add('active');
    }

    function selectPlace(name, lat, lon, rating, price, time, desc, city) {
      searchInput.value = name;
      autocompleteList.classList.remove('active');
      currentCity = city;
      document.getElementById('city-select').value = city;
      filterAndSort();
      const distance = calculateDistance(userLocation.lat, userLocation.lon, lat, lon);
      showPlace(name, lat, lon, rating, price, time, desc, distance);
    }

    async function performSearch(query) {
      if (!query || query.trim().length < 2) {
        return;
      }

      const queryLower = query.toLowerCase().trim();
      const found = Object.values(allPlaces).flat().find(p => 
        p.name.toLowerCase().includes(queryLower) || p.desc.toLowerCase().includes(queryLower)
      );

      if (found) {
        currentCity = found.city;
        document.getElementById('city-select').value = currentCity;
        filterAndSort();
        showPlace(found.name, found.lat, found.lon, found.rating, found.price, found.time, found.desc, 
          calculateDistance(userLocation.lat, userLocation.lon, found.lat, found.lon));
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      getUserLocation();
      filterAndSort();
    });
  
</script>
  <script>
    // Location sorting helper for geolocation-based display
    function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
      var R = 6371; 
      var dLat = deg2rad(lat2-lat1); 
      var dLon = deg2rad(lon2-lon1); 
      var a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
        Math.sin(dLon/2) * Math.sin(dLon/2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = R * c; 
      return d;
    }

    function deg2rad(deg) { return deg * (Math.PI/180); }

    function sortListByLocation(userLat, userLon) {
        const list = document.querySelector('.list');
        if(!list) return;
        const items = Array.from(list.querySelectorAll('.item'));
        items.forEach(item => {
            const onclick = item.getAttribute('onclick');
            const match = onclick.match(/showPlace\s*\(\s*([\d\.]+)\s*,\s*([\d\.]+)/);
            if (match) item.dataset.distance = getDistanceFromLatLonInKm(userLat, userLon, parseFloat(match[1]), parseFloat(match[2]));
            else item.dataset.distance = 99999;
        });
        items.sort((a, b) => parseFloat(a.dataset.distance) - parseFloat(b.dataset.distance));
        items.forEach(item => list.appendChild(item));
    }

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => sortListByLocation(p.coords.latitude, p.coords.longitude));
    }
  </script>
</body>
</html>
